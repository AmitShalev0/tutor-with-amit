<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Booking Info – Amit Tutoring</title>
  <link rel="stylesheet" href="style.css" />
  <style>
    .booking-info-page {
      max-width: 980px;
      padding: 2.5rem 0 4rem;
    }

    .booking-info-header {
      display: flex;
      justify-content: space-between;
      align-items: flex-start;
      gap: 1rem;
      flex-wrap: wrap;
      margin-bottom: 1.5rem;
    }

    .booking-info-header h1 {
      margin: 0;
      font-size: 2rem;
    }

    .booking-info-header p {
      margin: 0.35rem 0 0;
      color: var(--muted);
      max-width: 560px;
    }

    .booking-info-meta {
      display: flex;
      align-items: center;
      gap: 0.75rem;
      color: var(--muted);
      font-size: 0.9rem;
      flex-wrap: wrap;
    }

    .info-message {
      margin: 1rem 0 2rem;
      padding: 0.85rem 1rem;
      border-radius: var(--radius-md);
      background: rgba(79, 157, 255, 0.12);
      color: var(--accent);
      font-size: 0.95rem;
    }

    .info-message.error {
      background: rgba(220, 53, 69, 0.12);
      color: #b91c1c;
    }

    .info-message.muted {
      background: none;
      padding: 0;
      color: var(--muted);
    }

    .booking-info-grid {
      display: grid;
      gap: 1.5rem;
      grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
    }

    .info-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }

    .info-card h2 {
      margin: 0;
      font-size: 1.25rem;
      color: var(--accent);
    }

    .info-card dl {
      margin: 0;
      display: grid;
      grid-template-columns: 1fr;
      gap: 0.75rem;
    }

    .info-card dl div {
      display: flex;
      justify-content: space-between;
      gap: 1rem;
    }

    .info-card dt {
      font-weight: 600;
      color: var(--muted);
    }

    .info-card dd {
      margin: 0;
      font-weight: 600;
      color: var(--text);
    }

    .availability-list,
    .courses-list {
      list-style: none;
      margin: 0;
      padding: 0;
      display: flex;
      flex-direction: column;
      gap: 0.6rem;
    }

    .availability-list li,
    .courses-list li {
      display: flex;
      justify-content: space-between;
      gap: 1rem;
      font-size: 0.95rem;
    }

    .availability-day {
      font-weight: 600;
      color: var(--muted);
    }

    .availability-value {
      color: var(--text);
    }

    .courses-list li {
      position: relative;
      padding-left: 1rem;
    }

    .courses-list li::before {
      content: "•";
      position: absolute;
      left: 0;
      color: var(--accent);
    }

    .info-footer {
      margin-top: 2.5rem;
      color: var(--muted);
      font-size: 0.9rem;
    }

    .edit-card {
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-lg);
      padding: 1.5rem;
      margin-bottom: 1.5rem;
    }
    .edit-card h2 {
      margin-top: 0;
      margin-bottom: 1rem;
    }
    .collapsible-group {
      display: flex;
      flex-direction: column;
      gap: 1rem;
    }
    .collapsible {
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 1rem 1.25rem;
      background: var(--surface-alt);
    }
    .collapsible + .collapsible {
      margin-top: 0.35rem;
    }
    .collapsible-header {
      display: flex;
      align-items: center;
      justify-content: space-between;
      gap: 0.75rem;
      cursor: pointer;
      -webkit-user-select: none;
      user-select: none;
    }
    .collapsible-header h3 {
      margin: 0;
    }
    .collapsible-toggle {
      background: none;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 0.35rem 0.6rem;
      font-size: 0.9rem;
      color: var(--text);
    }
    .collapsible-body {
      margin-top: 0.85rem;
    }
    .collapsible[data-collapsed="true"] .collapsible-body {
      display: none;
    }
    .collapsible[data-collapsed="true"] .collapsible-toggle::after {
      content: 'Show';
      margin-left: 0.5rem;
      color: var(--accent);
    }
    .collapsible[data-collapsed="false"] .collapsible-toggle::after {
      content: 'Hide';
      margin-left: 0.5rem;
      color: var(--accent);
    }
    .edit-grid {
      display: grid;
      gap: 1rem;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
    }
    .input-group label {
      display: block;
      font-weight: 600;
      margin-bottom: 0.35rem;
    }
    .input-grow {
      flex: 1;
      min-width: 140px;
    }
    .input-group input,
    .input-group textarea {
      width: 100%;
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      padding: 0.55rem 0.65rem;
      background: var(--surface-alt);
      color: var(--text);
      box-sizing: border-box;
    }
    .input-group textarea {
      min-height: 96px;
      resize: vertical;
    }
    .field-row {
      display: flex;
      gap: 1rem;
      flex-wrap: wrap;
    }
    .helper-text {
      color: var(--muted);
      font-size: 0.9rem;
      margin: 0.2rem 0 0;
    }
    .addon-rows {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }
    .addon-row {
      display: grid;
      grid-template-columns: 1.4fr 0.8fr auto;
      gap: 0.75rem;
      align-items: center;
    }
    @media (max-width: 640px) {
      .addon-row {
        grid-template-columns: 1fr;
      }
    }
    .addon-row .remove-btn {
      background: none;
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      padding: 0.45rem 0.65rem;
      color: var(--muted);
      cursor: pointer;
    }
    .addon-row .remove-btn:hover {
      color: var(--text);
      border-color: var(--accent);
    }
    .addon-add-btn {
      margin-top: 0.75rem;
    }
    .badge {
      display: inline-flex;
      align-items: center;
      padding: 0.2rem 0.55rem;
      border-radius: 999px;
      font-size: 0.85rem;
      background: rgba(79, 157, 255, 0.12);
      color: var(--accent);
    }
    .day-chips {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
      margin-top: 0.35rem;
    }
    .day-chip {
      display: inline-flex;
      align-items: center;
      gap: 0.35rem;
      padding: 0.3rem 0.65rem;
      border-radius: 999px;
      border: 1px solid var(--border);
      background: var(--surface-alt);
      color: var(--text);
    }
    .edit-actions {
      display: flex;
      gap: 0.75rem;
      flex-wrap: wrap;
      align-items: center;
      margin-top: 0.5rem;
    }
    .muted-note {
      color: var(--muted);
      font-size: 0.9rem;
    }
    .divider {
      border-top: 1px solid var(--border);
      margin: 1.25rem 0;
    }

    .edit-subsection {
      display: flex;
      flex-direction: column;
      gap: 1rem;
      margin-bottom: 1.5rem;
    }

    .inline-controls {
      display: flex;
      flex-wrap: wrap;
      gap: 0.75rem;
      align-items: center;
    }

    .inline-controls label {
      display: inline-flex;
      gap: 0.45rem;
      align-items: center;
      font-weight: 500;
      cursor: pointer;
    }

    .inline-field-row {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
      gap: 1rem;
      align-items: end;
    }

    .range-row {
      display: flex;
      flex-direction: column;
      gap: 0.35rem;
    }

    .range-row input[type="range"] {
      width: 100%;
    }

    .range-row .range-meta {
      display: flex;
      justify-content: space-between;
      font-size: 0.85rem;
      color: var(--muted);
    }

    .location-map-shell {
      border: 1px solid var(--border);
      border-radius: var(--radius-md);
      overflow: hidden;
      height: 280px;
      background: var(--surface-alt);
    }

    #location-map {
      width: 100%;
      height: 100%;
    }

    .pill-help {
      display: inline-block;
      padding: 0.2rem 0.6rem;
      border-radius: 999px;
      background: rgba(148, 163, 184, 0.2);
      color: var(--muted);
      font-size: 0.8rem;
      margin-left: 0.35rem;
    }

    .message-area {
      margin: 0.35rem 0;
      font-size: 0.95rem;
    }

    .message-area.ok {
      color: #22c55e;
    }

    .message-area.error {
      color: #ef4444;
    }

    .zone-pricing-section h3 {
      margin: 0 0 0.35rem 0;
    }

    .zone-pricing-section .helper-text {
      margin: 0 0 0.75rem 0;
    }

    @media (max-width: 640px) {
      .info-card dl div,
      .availability-list li {
        flex-direction: column;
        align-items: flex-start;
        gap: 0.25rem;
      }
    }
  </style>
</head>
<body data-no-auto-init="true">
  <div id="site-header"></div>
  <script src="header-loader.js"></script>

  <main class="container booking-info-page">
    <div class="booking-info-header">
      <div>
        <h1>Booking System</h1>
        <p>Review the current booking configuration that students see on the public booking form.</p>
      </div>
      <div class="booking-info-meta" id="booking-info-meta" hidden>
        <span id="booking-info-updated"></span>
      </div>
    </div>

    <p id="booking-info-status" class="info-message">Loading booking settings…</p>

    <section id="booking-edit-section" class="edit-card" hidden>
      <h2>Edit Booking Settings</h2>
      <form id="booking-edit-form">
        <div class="collapsible-group">
          <section id="booking-settings-section" class="edit-subsection collapsible" data-collapsed="false">
            <div class="collapsible-header" data-toggle="collapse" data-target="booking-settings-body">
              <h3>Booking settings</h3>
              <button type="button" class="collapsible-toggle" aria-controls="booking-settings-body"></button>
            </div>
            <div id="booking-settings-body" class="collapsible-body">
              <div class="edit-grid">
                <div class="input-group">
                  <label for="edit-max-students">Max students per session</label>
                  <input type="number" id="edit-max-students" min="1" max="8" step="1" />
                </div>
                <div class="input-group">
                  <label for="edit-max-hours">Max hours per session</label>
                  <input type="number" id="edit-max-hours" min="1" max="6" step="0.25" />
                </div>
                <div class="input-group">
                  <label for="edit-min-duration">Minimum session length (minutes)</label>
                  <input type="number" id="edit-min-duration" min="30" step="15" />
                </div>
                <div class="input-group">
                  <label for="edit-buffer-minutes">Time after session (minutes)</label>
                  <input type="number" id="edit-buffer-minutes" min="0" max="240" step="1" />
                  <p class="helper-text">Blocks this many minutes after each session on your booking calendar. Default 15.</p>
                </div>
                <div class="input-group">
                  <label for="edit-base-rate">Cost per session (first student)</label>
                  <input type="number" id="edit-base-rate" min="0" step="0.01" />
                </div>
                <div class="input-group">
                  <label for="edit-extra-rate">Cost per additional student</label>
                  <input type="number" id="edit-extra-rate" min="0" step="0.01" />
                </div>
                <div class="input-group">
                  <label for="edit-recurring-weeks">Max weeks in advance (recurring)</label>
                  <input type="number" id="edit-recurring-weeks" min="1" max="52" step="1" />
                </div>
              </div>

              <div class="divider"></div>
              <div class="input-group">
                <label>Optional add-ons <span class="badge">Checkboxes</span></label>
                <p class="helper-text">Families see these as optional checkboxes during booking. Use positive or negative amounts for surcharges or discounts.</p>
                <div id="addon-rows" class="addon-rows"></div>
                <p id="addon-empty" class="helper-text">No add-ons yet. Add your first one below.</p>
                <button type="button" class="btn secondary addon-add-btn" id="add-addon-btn">Add add-on</button>
              </div>
            </div>
          </section>

          <section id="travel-edit-section" class="edit-subsection collapsible" data-collapsed="false">
            <div class="collapsible-header" data-toggle="collapse" data-target="travel-settings-body">
              <h3>Meeting preferences &amp; travel</h3>
              <button type="button" class="collapsible-toggle" aria-controls="travel-settings-body"></button>
            </div>
            <div id="travel-settings-body" class="collapsible-body">
              <div class="inline-controls">
                <label><input type="checkbox" id="mode-online" /> Online</label>
                <label><input type="checkbox" id="mode-office" /> Tutor’s office / host</label>
                <label><input type="checkbox" id="mode-travel" /> Travel to student</label>
              </div>
              <p class="helper-text">Families can filter tutors based on preferred meeting formats.</p>

              <p id="office-address-hint" class="helper-text" hidden>
                When “Tutor’s office” is enabled, choose your exact office address in “Base location”.
                This address is included in approval emails and calendar invites.
              </p>

              <div class="inline-field-row">
                <div class="input-group">
                  <label for="location-search">Base location <span class="pill-help">Autocomplete</span></label>
                  <input type="text" id="location-search" placeholder="Start typing an address or landmark" autocomplete="off" />
                </div>
                <div class="input-group">
                  <label for="location-label">Display location label</label>
                  <input type="text" id="location-label" placeholder="e.g. Beltline, Calgary" />
                </div>
              </div>

              <div class="inline-controls">
                <label><input type="checkbox" id="travel-enabled" /> Allow travel to students</label>
              </div>
              <p class="helper-text">Turn this off if you only host or meet online or in 1 location. Travel radius and zones are only shown when enabled.</p>

              <div id="travel-fields">
                <div class="range-row">
                  <label for="travel-radius">Travel radius (km)</label>
                  <input type="range" id="travel-radius" min="0" max="50" value="10" step="1" />
                  <div class="range-meta">
                    <span>0 km</span>
                    <span><output id="travel-radius-value">10</output> km</span>
                    <span>50 km</span>
                  </div>
                </div>

                <div class="input-group">
                  <label for="travel-zones">Travel zone breaks (km)</label>
                  <input type="text" id="travel-zones" placeholder="e.g. 5, 10, 20" />
                  <p class="helper-text">Optional: add comma-separated breakpoints to show concentric travel zones. Values above the travel radius are ignored.</p>
                </div>
              </div>

              <div class="location-map-shell" aria-label="Tutor travel area map">
                <div id="location-map"></div>
              </div>
              <p id="location-status" class="message-area"></p>

              <div id="zone-pricing-section" class="zone-pricing-section" hidden>
                <h3>Travel zone pricing</h3>
                <p class="helper-text">Set per-zone price adjustments for in-person travel. Zones follow your travel radius settings.</p>
                <div id="zone-pricing-rows" class="edit-grid"></div>
              </div>
            </div>
          </section>

          <section id="calendar-edit-section" class="edit-subsection collapsible" data-collapsed="false">
            <div class="collapsible-header" data-toggle="collapse" data-target="calendar-settings-body">
              <h3>Calendar &amp; availability</h3>
              <button type="button" class="collapsible-toggle" aria-controls="calendar-settings-body"></button>
            </div>
            <div id="calendar-settings-body" class="collapsible-body">
              <div class="edit-grid">
                <div class="input-group">
                  <label>Calendar visible hours</label>
                  <div class="field-row">
                    <div class="input-group input-grow">
                      <label for="edit-calendar-start" class="muted-note">Start</label>
                      <input type="time" id="edit-calendar-start" step="3600" />
                    </div>
                    <div class="input-group input-grow">
                      <label for="edit-calendar-end" class="muted-note">End</label>
                      <input type="time" id="edit-calendar-end" step="3600" />
                    </div>
                  </div>
                  <p class="helper-text">Times must be on the hour (e.g., 09:00).</p>
                </div>
                <div class="input-group">
                  <label>Calendar days shown</label>
                  <div class="day-chips" id="edit-calendar-days">
                    <label class="day-chip"><input type="checkbox" value="0" /> Mon</label>
                    <label class="day-chip"><input type="checkbox" value="1" /> Tue</label>
                    <label class="day-chip"><input type="checkbox" value="2" /> Wed</label>
                    <label class="day-chip"><input type="checkbox" value="3" /> Thu</label>
                    <label class="day-chip"><input type="checkbox" value="4" /> Fri</label>
                    <label class="day-chip"><input type="checkbox" value="5" /> Sat</label>
                    <label class="day-chip"><input type="checkbox" value="6" /> Sun</label>
                  </div>
                </div>
              </div>

              <div class="divider"></div>

              <div class="edit-grid" id="edit-availability-grid">
                <div class="input-group availability-row" data-day="0">
                  <label>Monday availability</label>
                  <div class="field-row">
                    <div class="input-group compact input-grow">
                      <label class="muted-note">Start</label>
                      <input type="time" data-role="start" step="900" />
                    </div>
                    <div class="input-group compact input-grow">
                      <label class="muted-note">End</label>
                      <input type="time" data-role="end" step="900" />
                    </div>
                  </div>
                  <p class="helper-text">Leave blank if not available.</p>
                </div>
                <div class="input-group availability-row" data-day="1">
                  <label>Tuesday availability</label>
                  <div class="field-row">
                    <div class="input-group compact input-grow">
                      <label class="muted-note">Start</label>
                      <input type="time" data-role="start" step="900" />
                    </div>
                    <div class="input-group compact input-grow">
                      <label class="muted-note">End</label>
                      <input type="time" data-role="end" step="900" />
                    </div>
                  </div>
                  <p class="helper-text">Leave blank if not available.</p>
                </div>
                <div class="input-group availability-row" data-day="2">
                  <label>Wednesday availability</label>
                  <div class="field-row">
                    <div class="input-group compact input-grow">
                      <label class="muted-note">Start</label>
                      <input type="time" data-role="start" step="900" />
                    </div>
                    <div class="input-group compact input-grow">
                      <label class="muted-note">End</label>
                      <input type="time" data-role="end" step="900" />
                    </div>
                  </div>
                  <p class="helper-text">Leave blank if not available.</p>
                </div>
                <div class="input-group availability-row" data-day="3">
                  <label>Thursday availability</label>
                  <div class="field-row">
                    <div class="input-group compact input-grow">
                      <label class="muted-note">Start</label>
                      <input type="time" data-role="start" step="900" />
                    </div>
                    <div class="input-group compact input-grow">
                      <label class="muted-note">End</label>
                      <input type="time" data-role="end" step="900" />
                    </div>
                  </div>
                  <p class="helper-text">Leave blank if not available.</p>
                </div>
                <div class="input-group availability-row" data-day="4">
                  <label>Friday availability</label>
                  <div class="field-row">
                    <div class="input-group compact input-grow">
                      <label class="muted-note">Start</label>
                      <input type="time" data-role="start" step="900" />
                    </div>
                    <div class="input-group compact input-grow">
                      <label class="muted-note">End</label>
                      <input type="time" data-role="end" step="900" />
                    </div>
                  </div>
                  <p class="helper-text">Leave blank if not available.</p>
                </div>
                <div class="input-group availability-row" data-day="5">
                  <label>Saturday availability</label>
                  <div class="field-row">
                    <div class="input-group compact input-grow">
                      <label class="muted-note">Start</label>
                      <input type="time" data-role="start" step="900" />
                    </div>
                    <div class="input-group compact input-grow">
                      <label class="muted-note">End</label>
                      <input type="time" data-role="end" step="900" />
                    </div>
                  </div>
                  <p class="helper-text">Leave blank if not available.</p>
                </div>
                <div class="input-group availability-row" data-day="6">
                  <label>Sunday availability</label>
                  <div class="field-row">
                    <div class="input-group compact input-grow">
                      <label class="muted-note">Start</label>
                      <input type="time" data-role="start" step="900" />
                    </div>
                    <div class="input-group compact input-grow">
                      <label class="muted-note">End</label>
                      <input type="time" data-role="end" step="900" />
                    </div>
                  </div>
                  <p class="helper-text">Leave blank if not available.</p>
                </div>
              </div>
            </div>
          </section>
        </div>

        <div class="edit-actions">
          <button class="btn primary" type="submit" id="booking-save-btn">Save booking settings</button>
          <button class="btn secondary" type="button" id="booking-reset-btn">Reset</button>
          <span id="booking-edit-status" class="muted-note"></span>
        </div>
      </form>
    </section>

    <section id="booking-info-content" class="booking-info-grid" hidden>
      <article class="info-card">
        <h2>Session Pricing</h2>
        <dl>
          <div>
            <dt>First student</dt>
            <dd id="rate-base">—</dd>
          </div>
          <div>
            <dt>Each additional student</dt>
            <dd id="rate-extra">—</dd>
          </div>
        </dl>
      </article>

      <article class="info-card" id="addon-card" hidden>
        <h2>Optional Add-ons</h2>
        <ul id="addon-list" class="courses-list"></ul>
      </article>

      <article class="info-card" id="zone-pricing-card" hidden>
        <h2>Travel Zone Pricing</h2>
        <ul id="zone-pricing-list" class="courses-list"></ul>
      </article>

      <article class="info-card">
        <h2>Session Length &amp; Group Size</h2>
        <dl>
          <div>
            <dt>Minimum session length</dt>
            <dd id="session-min">—</dd>
          </div>
          <div>
            <dt>Maximum session length</dt>
            <dd id="session-max">—</dd>
          </div>
          <div>
            <dt>Time after session</dt>
            <dd id="session-buffer">—</dd>
          </div>
          <div>
            <dt>Maximum students per session</dt>
            <dd id="session-max-students">—</dd>
          </div>
          <div>
            <dt>Recurring sessions bookable up to</dt>
            <dd id="session-recurring">—</dd>
          </div>
        </dl>
      </article>

      <article class="info-card">
        <h2>Calendar Display</h2>
        <dl>
          <div>
            <dt>Visible hours</dt>
            <dd id="calendar-hours">—</dd>
          </div>
          <div>
            <dt>Visible days</dt>
            <dd id="calendar-days">—</dd>
          </div>
        </dl>
      </article>

      <article class="info-card">
        <h2>Weekly Availability</h2>
        <ul id="booking-availability-list" class="availability-list"></ul>
      </article>
    </section>

    <p id="booking-info-footer" class="info-footer" hidden></p>
  </main>

  <footer class="site-footer">
    <div class="container">
      <p>© <span id="year"></span> Amit Tutoring · <a href="contact.html">Contact us</a></p>
    </div>
  </footer>

  <script src="role-utils.js"></script>
  <script type="module" src="booking-settings-page.js"></script>
  <script src="admin.js" defer></script>
</body>
</html>

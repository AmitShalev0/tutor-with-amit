<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Admin Panel - TutorDesk</title>
  <link rel="stylesheet" href="style.css">
  <style>

/* style for the edit button */
    .session-detail-wrapper {
      display: flex;
      flex-direction: column;
      gap: 16px;
    }

    .session-select-cell,
    .data-table th.session-select-header {
      position: relative;
      padding-left: 40px;
    }

    .session-select-cell.has-toggle {
      padding-left: 40px;
    }

    .session-select-inner {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .checkbox-slot {
      display: inline-flex;
      align-items: center;
      justify-content: center;
    }

    .checkbox-slot.small {
      width: 16px;
    }

    .checkbox-slot.large {
      width: 18px;
    }

    .checkbox-placeholder {
      visibility: hidden;
    }

    .checkbox-slot input {
      width: 100%;
      height: 100%;
    }

    .session-checkbox {
      width: 16px;
      height: 16px;
    }

    .session-checkbox.session-checkbox-multi {
      width: 18px;
      height: 18px;
    }

    .group-select-all {
      width: 18px;
      height: 18px;
    }

    .group-toggle-btn {
      position: absolute;
      left: 8px;
      top: 50%;
      transform: translateY(-50%);
      width: 32px;
      height: 32px;
      display: inline-flex;
      align-items: center;
      justify-content: center;
      border-radius: 8px;
      margin: 0;
      padding: 0;
    }

    .session-comment-wrapper {
      margin-top: 12px;
      padding: 12px;
    }

    .session-comment-input {
      width: 90%;          /* take ~90% of the row width */
      max-width: 90%;
      min-width: 90%;
      min-height: 5rem;    /* ~4‚Äì5 lines tall */
      resize: vertical;    /* you can still drag bigger if you want */
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text);
      padding: 10px;
      font-size: 0.9rem;
    }

    /* Inline student editor layout */
    .student-detail-row .inline-form {
      background: var(--surface);
      padding: 12px 16px 16px;
      border-radius: var(--radius-sm);
      display: flex;
      flex-direction: column;
      gap: 12px;
    }

    .inline-row {
      display: grid;
      gap: 12px;
      align-items: flex-end;
    }

    .inline-row.cols-4 {
      grid-template-columns: repeat(4, minmax(150px, 1fr));
    }

    .inline-row.cols-3 {
      grid-template-columns: repeat(3, minmax(180px, 1fr));
    }

    .inline-row label {
      display: flex;
      flex-direction: column;
      gap: 6px;
      font-weight: 600;
      color: var(--text);
    }

    .inline-row input,
    .inline-row select,
    .inline-notes textarea {
      width: 100%;
      background: var(--surface-alt);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text);
      padding: 8px 10px;
      font-size: 0.95rem;
    }

    .inline-notes label {
      display: flex;
      flex-direction: column;
      gap: 8px;
      font-weight: 600;
      color: var(--text);
    }

    .inline-notes textarea {
      min-height: 4.5rem; /* ~3 lines */
      max-width: 100%;
      resize: vertical;
    }

    @media (max-width: 1100px) {
      .inline-row.cols-4 {
        grid-template-columns: repeat(2, minmax(180px, 1fr));
      }

      .inline-row.cols-3 {
        grid-template-columns: repeat(2, minmax(180px, 1fr));
      }
    }

    @media (max-width: 720px) {
      .inline-row.cols-4,
      .inline-row.cols-3 {
        grid-template-columns: 1fr;
      }
    }

    /* end of style for textbox */

    .modal-subtle-text {
      margin-top: 0;
      color: var(--muted);
    }

    .modal-action-row {
      display: flex;
      gap: 12px;
      justify-content: flex-end;
      margin-top: 24px;
    }


    .admin-layout {
      display: grid;
      grid-template-columns: 240px 1fr;
      min-height: calc(100vh - 60px);
      gap: 0;
    }

    .admin-sidebar {
      background: var(--surface);
      border-right: 1px solid var(--border);
      padding: 24px 0;
    }

    .sidebar-nav {
      list-style: none;
      padding: 0;
      margin: 0;
    }

    .sidebar-nav li {
      margin: 4px 12px;
    }

    .sidebar-nav button {
      width: 100%;
      background: transparent;
      border: none;
      color: var(--muted);
      padding: 12px 16px;
      text-align: left;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-size: 0.95rem;
      transition: all 0.2s;
    }

    .sidebar-nav button:hover {
      background: var(--surface-alt);
      color: var(--text);
    }

    .sidebar-nav button.active {
      background: var(--accent);
      color: white;
    }

    .admin-content {
      padding: 32px;
      max-width: 1400px;
    }

    .admin-section {
      display: none;
    }

    .admin-section.active {
      display: block;
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .section-header h2 {
      margin: 0;
      font-size: 1.75rem;
    }

    .section-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 0.5rem;
    }

    .invoice-notes {
      white-space: pre-wrap;
      font-size: 0.9rem;
      color: var(--text);
    }

    .invoice-notes-trigger {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      font-weight: 600;
      color: var(--accent);
    }

    .invoice-notes-trigger.empty {
      color: var(--muted);
      font-weight: 500;
    }

    .invoice-notes-display {
      white-space: pre-wrap;
      font-size: 0.95rem;
      line-height: 1.5;
      color: var(--text);
    }

    .invoice-notes-display.empty {
      color: var(--muted);
    }

    .invoice-comment-wrapper.readonly {
      background: var(--surface);
    }

    .calendar-card {
      background: var(--surface);
      padding: 24px;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
    }

    .calendar-card p {
      margin-top: 0;
    }

    .calendar-description {
      color: var(--muted);
    }

    .calendar-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
      align-items: center;
      margin-top: 20px;
    }

    .sync-result {
      margin-top: 20px;
      color: var(--muted);
    }

    .sync-success {
      color: #28a745;
      margin: 0;
    }

    .sync-warning {
      color: #ffc107;
      margin: 0;
    }

    .sync-error {
      color: #dc3545;
      margin: 0;
    }

    .sync-summary-list {
      margin: 8px 0 0;
      padding-left: 20px;
      color: var(--text);
      font-size: 0.95rem;
    }

    .paid-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      background: #198754;
      color: #fff;
      font-size: 0.75rem;
      font-weight: 600;
    }

    .paid-meta {
      display: inline-block;
      margin-top: 4px;
      color: var(--muted);
      font-size: 0.85rem;
    }

    .invoice-row-clickable {
      cursor: pointer;
    }

    .invoice-row-clickable:hover {
      background: rgba(148, 163, 184, 0.15);
    }

    .invoice-notes-row td {
      background: var(--surface-alt);
    }

    .invoice-comment-wrapper {
      padding: 16px;
    }

    .form-actions-row {
      display: flex;
      gap: 12px;
      flex-wrap: wrap;
      align-items: center;
    }

    .btn {
      background: var(--accent);
      color: white;
      border: none;
      padding: 10px 20px;
      border-radius: var(--radius-sm);
      cursor: pointer;
      font-size: 0.95rem;
      transition: opacity 0.2s;
    }

    .btn-warning {
      background: rgba(244, 200, 110, 0.82);
      color: #111827;
    }

    .btn-warning:hover {
      background: rgba(230, 176, 72, 0.88);
    }


    .btn:hover {
      opacity: 0.9;
    }

    .btn-secondary {
      background: var(--surface-alt);
      color: var(--text);
    }

    .btn-danger {
      background: #dc3545;
    }

    .btn-success {
      background: #28a745;
    }

    .btn-sm {
      padding: 6px 12px;
      font-size: 0.85rem;
    }

    .data-table {
      width: 100%;
      background: var(--surface);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      overflow-x: auto;
    }

    .data-table table {
      width: 100%;
      border-collapse: collapse;
    }

    .data-table th {
      background: var(--surface-alt);
      padding: 12px 16px;
      text-align: left;
      font-weight: 600;
      font-size: 0.9rem;
      color: var(--muted);
      border-bottom: 1px solid var(--border);
    }

    .data-table td {
      padding: 12px 16px;
      border-bottom: 1px solid var(--border);
    }

    .data-table tr:last-child td {
      border-bottom: none;
    }

    .data-table tr:hover {
      background: var(--surface-alt);
    }

    .data-table tr.conflict-row {
      background: rgba(244, 63, 94, 0.18);
    }

    .data-table tr.conflict-row:hover {
      background: rgba(244, 63, 94, 0.25);
    }

    .role-select {
      width: 100%;
      min-width: 160px;
      padding: 6px 10px;
      border-radius: var(--radius-sm);
      border: 1px solid var(--border);
      background: var(--surface-alt);
      color: var(--text);
      font-size: 0.9rem;
    }

    .role-select:disabled {
      opacity: 0.65;
      cursor: not-allowed;
    }

    .role-meta-note {
      margin-top: 6px;
      font-size: 0.75rem;
      color: var(--muted);
      max-width: 220px;
    }

    .users-section-card {
      margin-top: 28px;
    }

    .section-subheading {
      margin: 0 0 12px;
      font-size: 1.2rem;
      color: var(--accent);
    }

    .data-table tr.selected-row {
      background: rgba(102, 126, 234, 0.15);
    }

    .data-table tr.selected-row:hover {
      background: rgba(102, 126, 234, 0.22);
    }

    .data-table tr.pending-conflict {
      background: rgba(250, 204, 21, 0.18);
    }

    .data-table tr.pending-conflict:hover {
      background: rgba(250, 204, 21, 0.24);
    }

    .data-table tr.conflict-row.selected-row,
    .data-table tr.selected-row.conflict-row {
      background: rgba(244, 63, 94, 0.28);
    }

    .data-table tr.pending-conflict.selected-row,
    .data-table tr.selected-row.pending-conflict {
      background: rgba(250, 204, 21, 0.26);
    }

    .status-badge {
      display: inline-block;
      padding: 4px 10px;
      border-radius: 12px;
      font-size: 0.8rem;
      font-weight: 500;
    }

    .status-pending {
      background: #ffc107;
      color: #000;
    }

    .status-approved {
      background: #28a745;
      color: white;
    }

    .status-rejected {
      background: #dc3545;
      color: white;
    }
    .status-pending_payment {
      background: #fef3c7;
      color: #92400e;
    }
    .status-succeed_payment {
      background: #d1fae5;
      color: #065f46;
    }
    .status-failed_payment {
      background: #fee2e2;
      color: #991b1b;
    }
    .status-payment_cancelled {
      background: #ede9fe;
      color: #5b21b6;
    }
    .status-payment_refunded {
      background: #cffafe;
      color: #0e7490;
    }

    .search-box {
      margin-bottom: 20px;
    }

    .search-box input {
      width: 100%;
      max-width: 400px;
      padding: 10px 16px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text);
      font-size: 0.95rem;
    }

    .empty-state {
      text-align: center;
      padding: 60px 20px;
      color: var(--muted);
    }

    .empty-state h3 {
      margin: 0 0 8px;
      color: var(--text);
    }

    .loading {
      text-align: center;
      padding: 40px;
      color: var(--muted);
    }

    .sync-status {
      display: inline-flex;
      align-items: center;
      gap: 8px;
      padding: 8px 16px;
      background: var(--surface);
      border-radius: var(--radius-sm);
      font-size: 0.9rem;
      color: var(--muted);
    }

    .sync-indicator {
      width: 8px;
      height: 8px;
      border-radius: 50%;
      background: var(--muted);
    }

    .sync-indicator.success {
      background: #28a745;
    }

    .action-buttons {
      display: flex;
      justify-content: flex-end;
      align-items: center;
      gap: 8px;
    }

    .stats-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
      gap: 20px;
      margin-bottom: 32px;
    }

    .stat-card {
      background: var(--surface);
      padding: 20px;
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
    }

    .stat-card h3 {
      margin: 0 0 8px;
      font-size: 2rem;
      color: var(--accent);
    }

    .stat-card p {
      margin: 0;
      color: var(--muted);
      font-size: 0.9rem;
    }

    /* Modal styles */
    .modal-overlay {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      right: 0;
      bottom: 0;
      background: rgba(0, 0, 0, 0.8);
      z-index: 1000;
      align-items: center;
      justify-content: center;
    }

    .modal-overlay.active {
      display: flex;
    }

    .modal-content {
      background: var(--surface);
      padding: 32px;
      border-radius: var(--radius-lg);
      max-width: 500px;
      width: 90%;
      max-height: 80vh;
      overflow-y: auto;
      border: 1px solid var(--border);
    }

    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 24px;
    }

    .modal-header h3 {
      margin: 0;
      font-size: 1.5rem;
    }

    .modal-close {
      background: transparent;
      border: none;
      color: var(--muted);
      font-size: 1.5rem;
      cursor: pointer;
      padding: 0;
      width: 32px;
      height: 32px;
    }

    .form-group {
      margin-bottom: 20px;
    }

    .form-group label {
      display: block;
      margin-bottom: 8px;
      font-weight: 500;
      color: var(--text);
    }

    .form-group input,
    .form-group select,
    .form-group textarea {
      width: 100%;
      padding: 10px 12px;
      background: var(--surface-alt);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text);
      font-size: 0.95rem;
    }

    .form-group textarea {
      resize: vertical;
      min-height: 80px;
    }

    /* Comment section styles */
    .session-comment {
      margin-top: 8px;
      padding: 12px;
      background: var(--surface-alt);
      border-radius: var(--radius-sm);
      border-left: 3px solid var(--accent);
    }

    .session-comment-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }

    .session-comment-author {
      font-size: 0.85rem;
      color: var(--accent);
      font-weight: 600;
    }

    .session-comment-text {
      color: var(--text);
      font-size: 0.9rem;
      line-height: 1.5;
      white-space: pre-wrap;
    }

    .comment-form {
      margin-top: 12px;
      padding: 12px;
      background: var(--surface-alt);
      border-radius: var(--radius-sm);
    }

    .comment-form textarea {
      width: 100%;
      padding: 10px;
      background: var(--surface);
      border: 1px solid var(--border);
      border-radius: var(--radius-sm);
      color: var(--text);
      font-size: 0.9rem;
      resize: vertical;
      min-height: 80px;
      margin-bottom: 8px;
    }

    .settings-form {
      display: flex;
      flex-direction: column;
      gap: 20px;
      background: var(--surface);
      border-radius: var(--radius-lg);
      border: 1px solid var(--border);
      padding: 24px;
      max-width: 760px;
    }

    .settings-columns {
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    }

    .availability-grid {
      display: grid;
      gap: 16px;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    }

    .day-checkbox-grid {
      display: grid;
      gap: 8px 16px;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
    }

    .day-checkbox-grid label {
      display: flex;
      align-items: center;
      gap: 8px;
      font-weight: 500;
    }

    .settings-hint {
      color: var(--muted);
      font-size: 0.9rem;
      margin-top: -6px;
    }

    .settings-heading {
      margin: 0;
    }

    .settings-actions {
      display: flex;
      flex-wrap: wrap;
      gap: 12px;
    }

    .form-message {
      font-size: 0.9rem;
      margin: 0;
    }

    .form-message.ok {
      color: #28a745;
    }

    .form-message.error {
      color: #dc3545;
    }

    .form-message:empty {
      display: none;
    }

    .session-row {
      cursor: pointer;
    }

    .session-row.expanded {
      background: var(--surface-alt);
    }

    .session-row.session-conflict {
      background: rgba(244, 63, 94, 0.2) !important;
    }

    .session-row.session-conflict:hover {
      background: rgba(244, 63, 94, 0.28) !important;
    }

    .recurring-child {
      background: rgba(59, 130, 246, 0.08);
    }

    .recurring-child:hover {
      background: rgba(59, 130, 246, 0.12);
    }
  </style>
</head>
<body>
  <div id="site-header"></div>
  <script src="header-loader.js"></script>

  <!-- Admin Layout -->
  <div class="admin-layout">
    <!-- Sidebar -->
    <aside class="admin-sidebar">
      <ul class="sidebar-nav">
        <li><button onclick="showSection('dashboard')" class="nav-btn active" data-section="dashboard">üìä Dashboard</button></li>
        <li><button onclick="showSection('sessions')" class="nav-btn" data-section="sessions">üìÖ Sessions</button></li>
        <li><button onclick="showSection('bookings')" class="nav-btn" data-section="bookings">üìù Booking Approvals</button></li>
        <li><button onclick="showSection('booking-info')" class="nav-btn" data-section="booking-info">‚öôÔ∏è Booking Settings</button></li>
        <li><button onclick="showSection('students')" class="nav-btn" data-section="students">üë• Students</button></li>
        <li><button onclick="showSection('users')" class="nav-btn" data-section="users">üîê Users</button></li>
        <li><button onclick="showSection('courses')" class="nav-btn" data-section="courses">üìö Courses</button></li>
        <li><button onclick="showSection('blocked')" class="nav-btn" data-section="blocked">üö´ Blocked Emails</button></li>
        <li><button onclick="showSection('sync')" class="nav-btn" data-section="sync">üîÑ Calendar Sync</button></li>
        <li><button onclick="showSection('invoices')" class="nav-btn" data-section="invoices">üí∞ Invoices</button></li>
      </ul>
    </aside>

    <!-- Main Content -->
    <main class="admin-content">
      <!-- Dashboard -->
      <section id="dashboard-section" class="admin-section active">
        <div class="section-header">
          <h2>Dashboard</h2>
        </div>
        <div class="stats-grid">
          <div class="stat-card">
            <h3 id="stat-sessions">-</h3>
            <p>Total Sessions</p>
          </div>
          <div class="stat-card">
            <h3 id="stat-pending">-</h3>
            <p>Pending Bookings</p>
          </div>
          <div class="stat-card">
            <h3 id="stat-students">-</h3>
            <p>Total Students</p>
          </div>
          <div class="stat-card">
            <h3 id="stat-users">-</h3>
            <p>Registered Users</p>
          </div>
        </div>
        <p class="help-text">Welcome to your admin panel. Use the sidebar to navigate.</p>
      </section>

      <!-- Sessions -->
      <section id="sessions-section" class="admin-section">
        <div class="section-header">
          <h2>Sessions</h2>
          <div class="section-actions">
            <button class="btn btn-danger hidden" id="delete-selected-sessions-btn" onclick="deleteSelectedSessions()">Delete Selected (<span id="selected-sessions-count">0</span>)</button>
            <button class="btn btn-warning hidden" id="bulk-edit-times-btn" onclick="openBulkEditModal()">Edit Selected Times</button>
            <button class="btn" onclick="loadSessions()">üîÑ Refresh</button>
          </div>
        </div>
        <div class="search-box">
          <input type="text" id="sessions-search" placeholder="Search sessions by student name..." oninput="filterSessions()">
        </div>
        <div id="sessions-container" class="loading">Loading sessions...</div>
      </section>

      <!-- Booking Approvals -->
      <section id="bookings-section" class="admin-section">
        <div class="section-header">
          <h2>Booking Approvals</h2>
          <button class="btn" onclick="loadBookings()">üîÑ Refresh</button>
        </div>
        <div id="bookings-container" class="loading">Loading bookings...</div>
      </section>

      <!-- Booking Settings -->
      <section id="booking-info-section" class="admin-section">
        <div class="section-header">
          <h2>Booking Settings</h2>
        </div>
        <p class="settings-hint">Configure the defaults that power the public booking form.</p>

        <form id="booking-settings-form" class="settings-form">
          <div class="settings-columns">
            <div class="form-group">
              <label for="booking-max-students">Max students per session</label>
              <input type="number" id="booking-max-students" name="maxStudents" min="1" max="8" step="1" required>
            </div>

            <div class="form-group">
              <label for="booking-max-hours">Max hours per session</label>
              <input type="number" id="booking-max-hours" name="maxHours" min="1" max="6" step="0.25" required>
            </div>

            <div class="form-group">
              <label for="booking-min-duration">Minimum session length (minutes)</label>
              <input type="number" id="booking-min-duration" name="minDuration" min="30" max="360" step="15" required>
              <p class="settings-hint">Sessions must run at least this long; booking options will follow this rule.</p>
            </div>

            <div class="form-group">
              <label for="booking-base-rate">Cost per session (first student)</label>
              <input type="number" id="booking-base-rate" name="baseRate" min="0" step="0.01" required>
            </div>

            <div class="form-group">
              <label for="booking-extra-rate">Cost per additional student</label>
              <input type="number" id="booking-extra-rate" name="extraRate" min="0" step="0.01" required>
            </div>

            <div class="form-group">
              <label for="booking-recurring-weeks">Max weeks in advance for recurring sessions</label>
              <input type="number" id="booking-recurring-weeks" name="recurringWeeks" min="1" max="52" step="1" required>
            </div>
          </div>

          <div class="form-group">
            <label for="booking-courses">Courses you offer</label>
            <textarea id="booking-courses" name="courses" rows="4" placeholder="One course per line"></textarea>
            <p class="settings-hint">This list is informational for now; we will wire it into the booking form later.</p>
          </div>

          <div>
            <h3 class="settings-heading">Calendar display</h3>
            <p class="settings-hint">Choose which days appear in the booking calendar and the hour range that should be visible.</p>
            <div class="settings-columns">
              <div class="form-group">
                <label for="calendar-start-time">Calendar start time</label>
                <input type="time" id="calendar-start-time" step="3600" required>
              </div>
              <div class="form-group">
                <label for="calendar-end-time">Calendar end time</label>
                <input type="time" id="calendar-end-time" step="3600" required>
              </div>
            </div>
            <div class="form-group">
              <label>Days shown in calendar</label>
              <div class="day-checkbox-grid" id="calendar-visible-days">
                <label><input type="checkbox" value="0"> Monday</label>
                <label><input type="checkbox" value="1"> Tuesday</label>
                <label><input type="checkbox" value="2"> Wednesday</label>
                <label><input type="checkbox" value="3"> Thursday</label>
                <label><input type="checkbox" value="4"> Friday</label>
                <label><input type="checkbox" value="5"> Saturday</label>
                <label><input type="checkbox" value="6"> Sunday</label>
              </div>
            </div>
          </div>

          <div>
            <h3 class="settings-heading">Weekly availability</h3>
            <p class="settings-hint">Use 24-hour ranges like 15:00-18:00. Separate multiple ranges with commas.</p>
            <div class="availability-grid">
              <div class="form-group">
                <label for="availability-mon">Monday</label>
                <input type="text" id="availability-mon" data-day="0" placeholder="15:00-18:00">
              </div>
              <div class="form-group">
                <label for="availability-tue">Tuesday</label>
                <input type="text" id="availability-tue" data-day="1" placeholder="15:00-18:00">
              </div>
              <div class="form-group">
                <label for="availability-wed">Wednesday</label>
                <input type="text" id="availability-wed" data-day="2" placeholder="15:00-18:00">
              </div>
              <div class="form-group">
                <label for="availability-thu">Thursday</label>
                <input type="text" id="availability-thu" data-day="3" placeholder="15:00-18:00">
              </div>
              <div class="form-group">
                <label for="availability-fri">Friday</label>
                <input type="text" id="availability-fri" data-day="4" placeholder="15:00-18:00">
              </div>
              <div class="form-group">
                <label for="availability-sat">Saturday</label>
                <input type="text" id="availability-sat" data-day="5" placeholder="15:00-18:00">
              </div>
              <div class="form-group">
                <label for="availability-sun">Sunday</label>
                <input type="text" id="availability-sun" data-day="6" placeholder="11:00-16:00">
              </div>
            </div>
          </div>

          <div class="settings-actions">
            <button type="submit" class="btn" id="booking-settings-save-btn">Save Settings</button>
            <button type="button" class="btn btn-secondary" onclick="resetBookingSettingsForm()">Cancel</button>
            <button type="button" class="btn btn-secondary" onclick="refreshBookingSettingsFromServer()">Reload</button>
          </div>

          <p id="booking-settings-status" class="form-message"></p>
        </form>
      </section>

      <!-- Students -->
      <section id="students-section" class="admin-section">
        <div class="section-header">
          <h2>Students</h2>
          <button class="btn" onclick="loadStudents()">üîÑ Refresh</button>
        </div>
        <div class="search-box">
          <input type="text" id="students-search" placeholder="Search students..." oninput="filterStudents()">
        </div>
        <div id="students-container" class="loading">Loading students...</div>
      </section>

      <!-- Users -->
      <section id="users-section" class="admin-section">
        <div class="section-header">
          <h2>Registered Users</h2>
          <button class="btn" onclick="loadUsers({ showStatus: true })">üîÑ Refresh</button>
        </div>
        <div class="search-box">
          <input type="text" id="users-search" placeholder="Search users..." oninput="filterUsers()">
        </div>
        <p id="users-status" class="form-message" role="status" aria-live="polite"></p>
        <div id="users-container" class="loading">Loading users...</div>
      </section>

      <!-- Courses -->
      <section id="courses-section" class="admin-section">
        <div class="section-header">
          <h2>Courses</h2>
          <div class="section-actions">
            <button class="btn" onclick="loadCoursesAdmin()">üîÑ Refresh</button>
            <button class="btn" onclick="resetCourseForm(true)">+ New Course</button>
            <button class="btn btn-danger" id="courses-bulk-delete-btn" onclick="bulkDeleteCourses()" disabled>üóë Delete Selected</button>
          </div>
        </div>

        <form id="course-form" class="card" onsubmit="handleCourseFormSubmit(event)">
          <input type="hidden" id="course-id" />
          <input type="hidden" id="course-request-id" />
          <div class="form-grid">
            <div class="form-group">
              <label for="course-name">Course name*</label>
              <input type="text" id="course-name" required placeholder="e.g. Math 20" />
            </div>
            <div class="form-group">
              <label for="course-subject">Subject</label>
              <select id="course-subject">
                <option value="">Select subject...</option>
                <option value="math">Math</option>
                <option value="english">English</option>
                <option value="social">Social</option>
                <option value="science">Science</option>
                <option value="other">Other</option>
              </select>
            </div>
            <div class="form-group">
              <label for="course-grade">Grade ceiling</label>
              <input type="number" id="course-grade" min="1" max="12" step="1" placeholder="e.g. 11" />
            </div>
            <div class="form-group">
              <label for="course-school">School</label>
              <input type="text" id="course-school" placeholder="e.g. U of A, Western Canada High" />
            </div>
          </div>
          <div class="form-group">
            <label for="course-description">Description</label>
            <textarea id="course-description" rows="3" placeholder="Notes or reason (for denied courses)"></textarea>
          </div>
          <div class="form-actions form-actions-row">
            <button type="submit" class="btn" id="course-save-btn">Save Course</button>
            <button type="button" class="btn btn-secondary" onclick="resetCourseForm(false)">Clear</button>
          </div>
          <p id="courses-message" class="form-message" role="status" aria-live="polite"></p>
        </form>

        <div id="courses-table" class="loading">Loading courses...</div>

        <h3 class="section-subheading">Pending Courses</h3>
        <div id="pending-courses-table" class="loading">Loading pending course requests...</div>

        <h3 class="section-subheading">Denied Courses</h3>
        <div id="denied-courses-table" class="loading">Loading denied course requests...</div>
      </section>

      <!-- Blocked Emails -->
      <section id="blocked-section" class="admin-section">
        <div class="section-header">
          <h2>Blocked Emails</h2>
          <div class="section-actions">
            <button class="btn" onclick="loadBlockedEmails()">üîÑ Refresh</button>
            <button class="btn btn-secondary" onclick="addBlockedEmail()">+ Add Blocked Email</button>
          </div>
        </div>
        <div id="blocked-container" class="loading">Loading blocked emails...</div>
      </section>

      <!-- Calendar Sync -->
      <section id="sync-section" class="admin-section">
        <div class="section-header">
          <h2>Google Calendar Sync</h2>
        </div>
        <div class="calendar-card">
          <p class="calendar-description">Sync your sessions with Google Calendar. This will create calendar events for any sessions that haven't been synced yet.</p>
          <div class="calendar-actions">
            <button class="btn" onclick="triggerSync()">üîÑ Sync Now</button>
            <button class="btn btn-warning" onclick="fullCalendarCleanup()">üßπ Clean &amp; Resync</button>
            <span class="sync-status">
              <span class="sync-indicator" id="sync-indicator"></span>
              <span id="sync-status-text">Ready to sync</span>
            </span>
          </div>
          <div id="sync-result" class="sync-result"></div>
        </div>
      </section>

      <!-- Invoices -->
      <section id="invoices-section" class="admin-section">
        <div class="section-header">
          <h2>Invoices</h2>
          <div class="section-actions">
            <button class="btn" onclick="loadInvoices()">üîÑ Refresh</button>
          </div>
        </div>
        <div id="invoices-container" class="loading">Loading invoices...</div>
      </section>
    </main>
  </div>

  <!-- Add Session Modal -->
  <div id="add-session-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Add Session</h3>
        <button class="modal-close" onclick="closeAddSessionModal()">√ó</button>
      </div>
      <form id="add-session-form" onsubmit="submitAddSession(event)">
        <input type="hidden" id="session-user-id">
        
        <div class="form-group">
          <label>User: <span id="session-user-name"></span></label>
        </div>

        <div class="form-group">
          <label for="session-student">Student*</label>
          <select id="session-student" required>
            <option value="">Select a student...</option>
          </select>
        </div>

        <div class="form-group">
          <label for="session-date">Date*</label>
          <input type="date" id="session-date" required>
        </div>

        <div class="form-group">
          <label for="session-start-time">Start Time*</label>
          <input type="time" id="session-start-time" required>
        </div>

        <div class="form-group">
          <label for="session-end-time">End Time*</label>
          <input type="time" id="session-end-time" required>
        </div>

        <div class="form-group">
          <label for="session-subject">Subject</label>
          <input type="text" id="session-subject" placeholder="e.g. Math 7, Physics 30">
        </div>

        <div class="modal-action-row">
          <button type="submit" class="btn">Create Session</button>
          <button type="button" class="btn btn-secondary" onclick="closeAddSessionModal()">Cancel</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Bulk Edit Sessions Modal -->
  <div id="bulk-edit-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Recurring Sessions</h3>
        <button class="modal-close" onclick="closeBulkEditModal()">√ó</button>
      </div>
      <form id="bulk-edit-form" onsubmit="submitBulkEdit(event)">
        <p id="bulk-edit-count" class="modal-subtle-text"></p>

        <div class="form-group">
          <label for="bulk-start-time">Start Time</label>
          <input type="time" id="bulk-start-time" required>
        </div>

        <div class="form-group">
          <label for="bulk-end-time">End Time</label>
          <input type="time" id="bulk-end-time" required>
        </div>

        <div class="modal-action-row">
          <button type="button" class="btn btn-secondary" onclick="closeBulkEditModal()">Cancel</button>
          <button type="submit" class="btn btn-warning" id="bulk-edit-submit-btn">Save Changes</button>
        </div>
      </form>
    </div>
  </div>

  <!-- Edit Student Modal -->
  <div id="student-edit-modal" class="modal-overlay">
    <div class="modal-content">
      <div class="modal-header">
        <h3>Edit Student</h3>
        <button class="modal-close" onclick="closeStudentEditModal()">√ó</button>
      </div>
      <form id="student-edit-form">
        <div class="form-group">
          <label for="admin-student-name">Student's Full Name*</label>
          <input type="text" id="admin-student-name" name="student_name" placeholder="Alex Johnson" required />
        </div>

        <div class="form-group">
          <label for="admin-birthdate">Birthdate</label>
          <input type="date" id="admin-birthdate" name="birthdate" min="1900-01-01" max="2030-12-31" />
        </div>

        <div class="form-group">
          <label for="admin-pronouns">Pronouns</label>
          <select id="admin-pronouns" name="pronouns">
            <option value="">Please select pronouns</option>
            <option value="he/him">He/Him</option>
            <option value="she/her">She/Her</option>
            <option value="they/them">They/Them</option>
            <option value="ze/zir">Ze/Zir</option>
            <option value="other">Other</option>
          </select>
        </div>

        <div class="form-group">
          <label for="admin-student-subject">Main Subject</label>
          <input type="text" id="admin-student-subject" name="subject" placeholder="Search or choose a course" list="admin-student-subject-options" autocomplete="off" />
          <datalist id="admin-student-subject-options"></datalist>
          <p class="help-text" id="admin-student-subject-help">Choose a course from the list or type any subject.</p>
        </div>

        <div class="form-group">
          <label for="admin-school">School</label>
          <input type="text" id="admin-school" name="school" placeholder="e.g. Woodbine Elementary" />
        </div>

        <div class="form-group">
          <label for="admin-relationship">Relationship</label>
          <select id="admin-relationship" name="relationship">
            <option value="">Select relationship...</option>
            <option value="dependent">Dependent</option>
            <option value="self">Self (I'm the student)</option>
            <option value="sibling">Sibling</option>
            <option value="friend">Friend</option>
            <option value="other">Other</option>
          </select>
        </div>

        <div class="form-group">
          <label for="admin-notes">Notes</label>
          <textarea id="admin-notes" name="notes" rows="4" placeholder="Any additional information..."></textarea>
        </div>

        <p id="student-edit-status" class="form-message" role="status" aria-live="polite"></p>

        <div class="modal-action-row">
          <button type="button" class="btn btn-secondary" onclick="closeStudentEditModal()">Cancel</button>
          <button type="submit" class="btn" id="student-edit-save-btn">Save Changes</button>
        </div>
      </form>
    </div>
  </div>

  <script type="module" src="admin-page.js"></script>
</body>
</html>
